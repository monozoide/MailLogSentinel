# Configuration

MailLogSentinel is configured via a central file, typically named `maillogsentinel.conf`. This file uses a simple INI-style format, divided into sections.

> **See also:** [FAQ & Troubleshooting](./FAQ%20&%20Troubleshooting.md)

## Configuration File (`maillogsentinel.conf`)

The default location for the main configuration file is usually established during the setup process (e.g., `/etc/maillogsentinel/maillogsentinel.conf` or a user-specific path). If the file is not found at the expected path, MailLogSentinel will fall back to default values for its operation.

The setup script (`maillogsentinel.py --setup`) helps in creating an initial version of this file.

Here's an overview of the sections and common options:

```ini
[paths]
# Working directory for logs, CSV reports, and other operational files
working_dir = /var/log/maillogsentinel
# Directory for storing internal state, like the last processed log offset
# Can be an absolute path or relative to working_dir
state_dir   = /var/lib/maillogsentinel 
# Path to the main Postfix log file (e.g., mail.log, maillog)
mail_log    = /var/log/mail.log
# Name of the CSV file where intrusion details are stored (within working_dir)
# csv_filename = maillogsentinel.csv

[report]
# Email address to send the summary reports to
email = security-team@example.org
# Optional prefix for the subject line of report emails
# report_subject_prefix = [MailLogSentinel]
# Optional sender address for the report. If empty, it defaults to user@fqdn.
# report_sender_override =

[geolocation]
# Path to the local copy of the country geolocation database (CSV format)
country_db_path = /var/lib/maillogsentinel/country_aside.csv
# URL to download/update the country database if it's missing or needs refreshing
# country_db_url = https://raw.githubusercontent.com/sapics/ip-location-db/main/asn-country/asn-country-ipv4-num.csv

[ASN_ASO]
# Path to the local copy of the ASN/ASO database (CSV format)
asn_db_path = /var/lib/maillogsentinel/asn.csv
# URL to download/update the ASN/ASO database
# asn_db_url = https://raw.githubusercontent.com/sapics/ip-location-db/refs/heads/main/asn/asn-ipv4-num.csv

[general]
# Logging level for MailLogSentinel's own operational logs.
# Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
log_level = INFO
# Path to MailLogSentinel's own log file.
# log_file = /var/log/maillogsentinel/maillogsentinel.log
# Maximum size of the operational log file in bytes before it's rotated.
# log_file_max_bytes = 1000000  (e.g., 1MB)
# Number of backup (rotated) operational log files to keep.
# log_file_backup_count = 5

[dns_cache]
# Enable or disable caching for reverse DNS lookups to improve performance and reduce external queries.
# enabled = true
# Maximum number of entries to store in the DNS cache.
# size = 128
# Time-to-live (TTL) for DNS cache entries in seconds (e.g., 3600 = 1 hour).
# ttl_seconds = 3600
```

## Key Configuration Options

### `[paths]`

*   **`working_dir`**: Specifies the primary directory where MailLogSentinel stores its operational files, including its own logs (if configured) and the CSV report of intrusions.
    *   Default: `/var/log/maillogsentinel`
*   **`state_dir`**: Defines where MailLogSentinel keeps its state information, most importantly the offset for the `mail_log` file. This allows it to remember where it left off and avoid reprocessing old log entries. It can be an absolute path or a path relative to `working_dir`.
    *   Default: `state` (relative to `working_dir`), making it `/var/log/maillogsentinel/state` if `working_dir` is default. The `config.py` defaults it to `/var/lib/maillogsentinel`.
*   **`mail_log`**: Crucial setting that points to your Postfix mail log file. This is the file MailLogSentinel will monitor.
    *   Default: `/var/log/mail.log`
*   **`csv_filename`**: The name of the CSV file generated by MailLogSentinel, containing details of detected intrusion attempts. This file will be located within the `working_dir`.
    *   Default: `maillogsentinel.csv`

### `[report]`

*   **`email`**: The email address to which MailLogSentinel will send its summary reports. This is a required field if you want email notifications.
    *   Default: `None` (no email sent by default if not specified)
*   **`subject_prefix`**: An optional prefix added to the subject line of report emails, helping to filter or identify them.
    *   Default: `[MailLogSentinel]`
*   **`sender_override`**: Allows you to specify a custom sender email address for the reports. If left blank, the system typically uses a default like `username@hostname`.
    *   Default: `None`

### `[geolocation]`

*   **`country_db_path`**: The local file system path to the IP-to-country geolocation database (in CSV format). `ipinfo.py` uses this database.
    *   Default: `/var/lib/maillogsentinel/country_aside.csv`
*   **`country_db_url`**: The URL from which the country geolocation database can be downloaded or updated. `ipinfo.py --update` uses this.
    *   Default: `https://raw.githubusercontent.com/sapics/ip-location-db/main/asn-country/asn-country-ipv4-num.csv`

### `[ASN_ASO]`

*   **`asn_db_path`**: The local file system path to the IP-to-ASN/ASO database (in CSV format). `ipinfo.py` uses this.
    *   Default: `/var/lib/maillogsentinel/asn.csv`
*   **`asn_db_url`**: The URL from which the ASN/ASO database can be downloaded or updated. `ipinfo.py --update` uses this.
    *   Default: `https://raw.githubusercontent.com/sapics/ip-location-db/refs/heads/main/asn/asn-ipv4-num.csv`

### `[general]`

*   **`log_level`**: Controls the verbosity of MailLogSentinel's own logging. Options are `DEBUG`, `INFO`, `WARNING`, `ERROR`, `CRITICAL`. `DEBUG` is most verbose, `CRITICAL` is least.
    *   Default: `INFO`
*   **`log_file`**: Specifies the path where MailLogSentinel writes its own operational logs.
    *   Default: `/var/log/maillogsentinel/maillogsentinel.log`
*   **`log_file_max_bytes`**: The maximum size in bytes for the `log_file` before it is rotated (archived and a new one started).
    *   Default: `1000000` (1MB)
*   **`log_file_backup_count`**: The number of old (rotated) log files to keep.
    *   Default: `5`

### `[dns_cache]`

*   **`enabled`**: Set to `true` to enable caching of reverse DNS lookup results, or `false` to disable it. Caching can significantly speed up processing and reduce DNS query load.
    *   Default: `True`
*   **`size`**: The maximum number of DNS entries to hold in the cache.
    *   Default: `128`
*   **`ttl_seconds`**: The "Time To Live" for cache entries, in seconds. After this duration, a cached entry is considered stale and will be re-fetched.
    *   Default: `3600` (1 hour)

**Note:** Lines starting with `#` or `;` in the configuration file are treated as comments and are ignored. If an option is commented out or missing, MailLogSentinel will use its internal default value for that setting. The `lib/maillogsentinel/config.py` file defines these defaults.
